app-id: org.texstudio.TeXstudio
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: texstudio
rename-icon: texstudio
rename-appdata-file: texstudio.appdata.xml
rename-desktop-file: texstudio.desktop
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri
  - --filesystem=host # required to open files
  - --filesystem=/tmp # this way lualatex etc. can access files newly ceated by TeXstudio stored in the hosts's /tmp
  - --allow=devel # needed for flatpak-spawn --host
  - --socket=session-bus # needed for flatpak-spawn --host
  - --talk-name=com.canonical.AppMenu.Registrar # gives application access to dbus menu
  - --share=network # required for LanguageTool
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/man
modules:
  - name: poppler # build dependency of TeXstudio
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=release
      - -DENABLE_QT5:BOOL=true
      - -DCMAKE_INSTALL_LIBDIR:PATH=/app/lib
    sources:
      - type: archive
        url: https://poppler.freedesktop.org/poppler-21.02.0.tar.xz
        sha256: 5c14759c99891e6e472aced6d5f0ff1dacf85d80cd9026d365c55c653edf792c
        x-checker-data:
          type: anitya
          project-id: 3686
          url-template: https://poppler.freedesktop.org/poppler-$version.tar.xz

  - name: texstudio
    buildsystem: qmake
    cleanup-platform:
      - /bin
      - /mkspecs
    sources:
      - type: git # use git to determine release date for appdata from version 3.0.5 on
        url: https://github.com/texstudio-org/texstudio
        tag: 3.0.5rc1
        commit: 18b2578128055f48181bb4228910db2b05f06ca1
        x-checker-data:
          type: anitya
          project-id: 6239
          tag-template: $version
      - type: patch
        path: 0001-Add-Flatpak-shim-to-execprogram.cpp-and-grammarcheck.cpp.patch
